<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>AngularJS, ES6 and Webpack</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/sky.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Towards AngularJS 2, with Webpack and ES6</h1>
					<br />
					<h2>Alexandru Badiu</h2>
					<h3>Development Lead @ Corbis</h3>
				</section>

				<section>
					<h1>In this presentation</h1>
					<ul>
						<li>Why we settled on Webpack</li>
						<li>How can you make your transition to AngularJS 2 easier</li>
					</ul>
				</section>

				<section>
					<h1>Grunt</h1>
					<ul>
						<li>Grunt with Yeoman</li>
						<li>
							The “classic” structure
<code><pre>
/controllers
/services
/filters
/directives
/views				
</pre></code></li>
						<li>Put as much as we could inside Bower</li>
					</ul>
				</section>

				<section>
					<h1>Grunt</h1>
					<ul>
						<li>That structure is not good for bigger projects</li>
						<li>Bower workflow was too time consuming</li>
					</ul>
				</section>

				<section>
					<h1>Gulp</h1>
					<ul>
						<li>Gulp and Browserify</li>
						<li>
							A “component” based structure
<code><pre>
/search
/auth
/misc
/core
</pre></code></li>
						<li>Worked pretty well</li>
					</ul>
				</section>

				<section>
					<h1>But...</h1>
					<ul>
						<li>Lazy loading?</li>
						<li>Polymer, Web components</li>
						<li>Component directives</li>
						<li>Self contained modules</li>
						<li>Bundle the assets, templates and CSS as well?</li>
					</ul>
				</section>

				<section>
					<h1>But...</h1>
					<ul>
						<li>Browserify can't do that</li>
						<li>But it's ecosystem can</li>
						<li>OSCON 2014: How Instagram.com Works; Pete Hunt</li>
						<li>Webpack!</li>
					</ul>
				</section>

				<section>
					<h1>Webpack</h1>
					<img src="images/webpack.png" />
				</section>
				<section>
					<h1>Webpack</h1>
					<h3>Require all the things!</h3>
					<ul>
						<li><code>require('./template.html');</code></li>
						<li><code>require('./template.jade');</code></li>
						<li><code>require('./component.scss');</code></li>
						<li><code>require('./logo.img');</code></li>
						<li><code>require('./jsmodule');</code></li>
						<li><code>require('./jsmodule.es6');</code></li>
					</ul>
				</section>

				<section>
					<h1>Webpack</h1>
					<ul>
						<li>One or more entry points</li>
						<li>Dependency graph</li>
						<li>Extensible via loaders</li>
						<li>One or more bundles</li>
						<li>Lazy loading</li>
					</ul>
				</section>

				<section>
					<h1>Webpack</h1>
					<pre><code style="font-size: 0.6em;">
entry: "./app/main.js",     
output: { path: path.resolve(__dirname, './build'), filename: '[name].js' },
module: {
  loaders: [
    { test: /\.js$/, loader: 'babel-loader' },
    { test: /\.scss$/, loader: 'style-loader!css-loader!autoprefixer-loader!sass-loader' },
    { test: /\.png$/, loader: 'url-loader?limit=100000&mimetype=image/png' }
  ]
},
resolve: {
  modulesDirectories: [ 'node_modules', 'app/vendor' ],
  alias: { lodash: path.resolve(__dirname, './app/vendor/lodash') }
},
plugins: [ new webpack.ProvidePlugin({ _: 'lodash' }) ]
					</code></pre>
				</section>

				<section>
					<h1>Webpack</h1>
					<pre><code style="font-size: 0.6em;">
'use strict';
require('./foo.scss');
var mod = angular.module('bar.foo', [
  require('../components/header').name,
  require('../components/footer').name,
  require('../components/search').name,
  require('../components/search-ui').name
]);
register(mod.name).controller('FooController', require('./foo.js'));
module.exports = mod;
					</code></pre>
				</section>

				<section>
					<h1>Webpack</h1>
					<pre><code style="font-size: 0.6em;">
'use strict';
require('./bar.scss');
require('ui.bootstrap/src/dropdown/dropdown');
var mod = angular.module('foo.bar', [
  'ui.bootstrap.dropdown'
  ]);
register(mod.name).directive('bar', require('./bar.js'));
module.exports = mod;
					</code></pre>
				</section>

				<section>
					<h1>Structure</h1>
					<ul>
						<li>Inspired by Google's</li>
					</ul>
<pre><code>
/index.jade
/main.js
/state1/
/state2/
/components/				
</code></pre>
				</section>

				<section>
					<h1>Structure</h1>
					<ul>
						<li>Components</li>
					</ul>
<pre><code>
/core
/independent_module1
/independent_module2
/ui/
/ui/header/
/ui/search-box/
</code></pre>
				</section>

				<section>
					<h1>Lazy loading</h1>
					<ul>
						<li><code>require.ensure();</code></li>
					</ul>
<pre><code>
.state('foo', {
	resolve: /*@ngInject*/function ($q, $ocLazyLoad) {
		require.ensure([], function() {
			var mod = require('./foo');
		});
	}
})
.state('bar', {
	resolve: /*@ngInject*/function ($q, $ocLazyLoad) {
		require.ensure([], function() {
			var mod = require('./bar');
		});
	}
})
</code></pre>
				</section>

				<section>
					<h1>Lazy loading</h1>
					<ul>
						<li>We'll use ocLazyLoad</li>
					</ul>
<pre><code>
.state('foo', {
	resolve: /*@ngInject*/function ($q, $ocLazyLoad) {
		var deferred = $q.defer();

		require.ensure([], function() {
			var mod = require('./foo');
			$ocLazyLoad.load({
				name: mod.name
			});

			deferred.resolve(mod.controller);
		});

		return deferred.promise;
	}
})
</code></pre>
				</section>

				<section>
					<h1>Lazy loading</h1>
					<ul>
						<li>Webpack does the async loading</li>
						<li>ocLazyLoad registers the new module</li>
						<li>Support for Webpack in <a href="https://github.com/ocombe/ocLazyLoad/issues/141">ocLazyLoad 1.2</a></li>
					</ul>
				</section>


				<section>
					<h1>AngularJS 2</h1>
					<ul>
						<li>Uses TypeScript</li>
						<li>Uses ES6, classes</li>
						<li>Web components</li>
						<li>Drops the $scope</li>
					</ul>
				</section>

				<section>
					<h1>No more $scope</h1>
					<ul>
						<li>Use <code>controllerAs</code> and <code>bindToController</code></li>
					</ul>
<pre><code>
  this.template = require('./search-box.jade');
  this.restrict = 'E';
  this.replace = true;
  this.controller = SearchBoxController;
  this.controllerAs = 'ctrl';
  this.bindToController = true;
  this.scope = {
    prefix: '=',
    model: '=ngModel'
  };

</code></pre>
				</section>

				<section>
					<h1>No more $scope</h1>
					<ul>
						<li>In AngularJS 1.4</li>
					</ul>
<pre><code>
  this.template = require('./search-box.jade');
  this.restrict = 'E';
  this.replace = true;
  this.controller = SearchBoxController;
  this.controllerAs = 'ctrl';
  this.bindToController = {
    prefix: '=',
    model: '=ngModel'
  };

</code></pre>
				</section>

				<section>
					<h1>No more $scope</h1>
					<ul>
						<li>Can't get rid of $scope completly now</li>
						<li><code>$watch</code>, <code>$digest</code> etc</li>
						<li>Treat it like any other service and inject it when needed</li>
					</ul>
<pre><code>
    $scope.$watch(angular.bind(this, function () {
      return this.efilter;
    }),
    (newVal) => {
      this.updateFilter(newVal);
    });

</code></pre>
				</section>

				<section>
					<h1>TypeScript and ES6</h1>
					<ul>
						<li>We can use ES6 today</li>
						<li><code>babel-loader</code></li>
						<li>TypeScript too</li>
					</ul>
				</section>

				<section>
					<h1>But...</h1>
					<ul>
						<li>I wouldn't use it</li>
						<li><a href="https://github.com/hannahhoward/a1atscript">https://github.com/hannahhoward/a1atscript</a></li>
						<li><a href="https://github.com/joehannes/sweet-at-angular">https://github.com/joehannes/sweet-at-angular</a></li>
						<li><a href="https://github.com/ng-harmony/ng-harmony">https://github.com/ng-harmony/ng-harmony</a></li>
					</ul>
				</section>

				<section>
					<h1>Why?</h1>
					<ul>
						<li>They are still in their infancy</li>
						<li>One man / woman projects</li>
						<li>Support?</li>
						<li>Lots of magic</li>
						<li>Training new people</li>
					</ul>
				</section>

				<section>
					<h1>In that case...</h1>
					<ul>
						<li>How can we use ES 6 classes?</li>
						<li><code>register.js</code>: <a href="http://www.michaelbromley.co.uk/blog/350/using-es6-classes-in-angularjs-1-x">Exploring ES6 Classes In AngularJS 1.x</a></li>
						<li>A small library that anyone can understand in 5 minutes that allows registering classes as directives, controllers etc</li>
					</ul>
				</section>

				<section>
					<h1>register.js</h1>
					<pre><code>
register('app')
    .controller('MyController', require('./my-angular-controller'))
    .service('myService', require('./my-angular-service'))
    .provider('myOtherService', require('./my-angular-provider'))
    .factory('myFactory', require('./my-angular-factory'))
    .directive('myDirective', require('./my-angular-directive'));						
					</code></pre>
				</section>

				<section>
					<h1>ES6</h1>
					<pre><code style='font-size: 0.8em; line-height: 1em;'>
class MyDirective {
    /*@ngInject*/
    constructor($interval) {
        this.template = '<div>I\'m a directive!</div>'; 
        this.restrict = 'E'; 
        this.scope = {};
        this.$interval = $interval; 
    } 
    compile(tElement) { 
        tElement.css('position', 'absolute'); 
    } 
    link(scope, element) { 
        this.$interval(() => this.move(element), 1000); 
    } 
    move(element) {
        element.css('left', (Math.random() * 500) + 'px'); 
        element.css('top', (Math.random() * 500) + 'px'); 
    } 
}					
					</code></pre>
				</section>

				<section>
					<h1>ES6</h1>
					<pre><code style='font-size: 0.8em; line-height: 1em;'>
class MyDirective {
    /*@ngInject*/
    constructor() {
        // ...
        this.scope = {
       	  title: '='
        };
        this.controller = 'MyDirectiveController';
        this.controllerAs = 'ctrl';
        this.bindToController = true;
    } 
}

class MyDirectiveController {
    /*@ngInject*/
    constructor($window) {
    	this.$window = $window;
    	console.log(this.title);
    } 
}

module.exports = MyDirective;
					</code></pre>
				</section>

				<section>
					<h1>Injection</h1>
					<ul>
						<li><code>MyDirectiveController.$inject = ['$window'];</code></li>
						<li>Do it automatically with <code>ng-annotator</code>.</li>
					</ul>
					<pre><code>
class MyDirectiveController {
    /*@ngInject*/
    constructor($window) {
    } 
}

resolve: /*@ngInject*/function ($q, $ocLazyLoad) {
}
					</code></pre>
				</section>

				<section>
					<h1>The final stack</h1>
					<ul>
						<li>Gulp</li>
						<li>Webpack and webpack-dev-server</li>
						<li>Superstatic and BrowserSync</li>
						<li>ES6 and eslint</li>
						<li>Jade</li>
						<li>SASS and Bourbon</li>
						<li>Karma and Protractor</li>
						<li>Mocha, Chai, Sinon</li>
						<li>Bamboo</li>
					</ul>
				</section>

				<section>
					<h1>Resources</h1>
					<ul>
						<li><a href="https://github.com/voidberg/webpack-angularjs-lazyload">voidberg/webpack-angularjs-lazyload</a></li>
						<li><a href="https://github.com/voidberg/webpack-angularjs">voidberg/webpack-angularjs</a></li>
						<li><a href="https://github.com/petehunt/webpack-howto">petehunt/webpack-howto</a></li>
						<li><a href="https://www.youtube.com/watch?v=VkTCL6Nqm6Y">OSCON 2014: How Instagram.com Works; Pete Hunt</a></li>
					</ul>
				</section>

				<section>
					<h1>Thanks</h1>
					<h3>Alexandru Badiu</h3>
					<h5>andu@ctrlz.ro</h5>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
